<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Hub</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <!-- Styles for the homepage -->
    <link rel="stylesheet" href="home.css">
    <!-- Tone.js for sound effects, loaded globally for all pages -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- Firebase SDKs (UPDATED: Using standard scripts for GitHub Pages compatibility) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>
<body class="bg-gray-900 text-white">

    <div class="background-overlay"></div>

    <!-- The content-container now takes up the full viewport height -->
    <div class="content-container flex flex-col items-center p-4 min-h-screen">
        <header class="text-center">
            <h1 class="text-5xl md:text-7xl font-black uppercase tracking-wider title-shadow">
                Game Hub
            </h1>
            <p class="mt-4 max-w-2xl text-lg md:text-xl text-gray-300 subtitle-shadow">
                Welcome to my collection of simple and fun browser games. Select a game below to get started!
            </p>
        </header>

        <!-- Auth Status and Button -->
        <div class="flex items-center gap-4 mt-6">
            <span id="auth-status" class="text-gray-300 text-lg">Signed out</span>
            <button id="auth-button" class="px-6 py-2 bg-indigo-600 text-white font-bold rounded-lg shadow-lg hover:bg-indigo-700 transition-all duration-300 ease-in-out transform hover:scale-105" data-click-sound="buttonClick">
                Sign In / Register
            </button>
        </div>

        <!-- Search Bar -->
        <div class="search-bar mt-8 w-full max-w-md flex items-center justify-center gap-2">
            <input type="text" id="game-search" placeholder="Search for games..." class="w-full p-3 rounded-lg bg-gray-700 border border-gray-600 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
            <button id="search-button" class="px-4 py-3 bg-blue-600 text-white font-bold rounded-lg shadow-md hover:bg-blue-700 transition-all duration-300 ease-in-out transform hover:scale-105" data-click-sound="buttonClick">
                <i class="fas fa-search"></i>
            </button>
        </div>

        <!-- Main content area for game cards. Using a responsive grid layout to ensure 3 columns on larger screens. -->
        <!-- Added horizontal padding (px-4) to provide space for hover effects. -->
        <!-- Using a responsive grid: 1 column on small screens, 2 on medium, 3 on large. -->
        <main class="game-library mt-12 w-full max-w-screen-md grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 py-4 overflow-y-auto flex-grow px-4">
            <!-- Game Card: 2048 -->
            <div class="game-card flex-shrink-0 w-full h-36 transition-all duration-300 ease-in-out transform hover:scale-105 hover:shadow-xl" data-hover-sound="cardHover" data-game-id="2048">
                <div class="game-card-content flex flex-col justify-center items-center h-full text-center">
                    <div class="game-card-title text-xl">2048</div>
                    <p class="game-card-description text-xs text-gray-400">
                        Join numbers to get 2048 tile.
                    </p>
                    <a href="game.html" class="play-button px-3 py-1 bg-blue-600 text-white font-bold rounded-lg shadow-lg hover:bg-blue-700 text-sm transition-all duration-300 ease-in-out transform hover:scale-105" data-click-sound="buttonClick">
                        Play Now
                    </a>
                </div>
            </div>

            <!-- Game Card: Tic-Tac-Toe -->
            <div class="game-card flex-shrink-0 w-full h-36 transition-all duration-300 ease-in-out transform hover:scale-105 hover:shadow-xl" data-hover-sound="cardHover" data-game-id="ticTacToe">
                <div class="game-card-content flex flex-col justify-center items-center h-full text-center">
                    <div class="game-card-title text-xl">Tic-Tac-Toe</div>
                    <p class="game-card-description text-xs text-gray-400">
                        Classic game vs friend or AI.
                    </p>
                    <div class="flex justify-center gap-2 w-full">
                        <a href="tic_tac_toe.html" class="play-button-small px-3 py-1 bg-blue-600 text-white font-bold rounded-lg shadow-lg hover:bg-blue-700 text-xs transition-all duration-300 ease-in-out transform hover:scale-105" data-click-sound="buttonClick">
                            Vs Friend
                        </a>
                        <a href="tic_tac_toe_ai.html" class="play-button-small px-3 py-1 bg-purple-600 text-white font-bold rounded-lg shadow-lg hover:bg-purple-700 text-xs transition-all duration-300 ease-in-out transform hover:scale-105" data-click-sound="buttonClick">
                            Vs AI
                        </a>
                    </div>
                </div>
            </div>

            <!-- Game Card: Hangman -->
            <div class="game-card flex-shrink-0 w-full h-36 transition-all duration-300 ease-in-out transform hover:scale-105 hover:shadow-xl" data-hover-sound="cardHover" data-game-id="hangman">
                <div class="game-card-content flex flex-col justify-center items-center h-full text-center">
                    <div class="game-card-title text-xl">Hangman</div>
                    <p class="game-card-description text-xs text-gray-400">
                        Guess letters, save the figure!
                    </p>
                    <a href="hangman.html" class="play-button px-3 py-1 bg-blue-600 text-white font-bold rounded-lg shadow-lg hover:bg-blue-700 text-sm transition-all duration-300 ease-in-out transform hover:scale-105" data-click-sound="buttonClick">
                        Play Now
                    </a>
                </div>
            </div>
            <!-- Adding more dummy game cards to ensure scroll functionality -->
            <div class="game-card flex-shrink-0 w-full h-36 transition-all duration-300 ease-in-out transform hover:scale-105 hover:shadow-xl" data-hover-sound="cardHover" data-game-id="newGame1">
                <div class="game-card-content flex flex-col justify-center items-center h-full text-center">
                    <div class="game-card-title text-xl">New Game 1</div>
                    <p class="game-card-description text-xs text-gray-400">
                        Placeholder for exciting game!
                    </p>
                    <a href="#" class="coming-soon-button px-3 py-1 bg-gray-500 text-white font-bold rounded-lg shadow-lg text-sm" data-click-sound="buttonClick">
                        Coming Soon
                    </a>
                </div>
            </div>
            <div class="game-card flex-shrink-0 w-full h-36 transition-all duration-300 ease-in-out transform hover:scale-105 hover:shadow-xl" data-hover-sound="cardHover" data-game-id="newGame2">
                <div class="game-card-content flex flex-col justify-center items-center h-full text-center">
                    <div class="game-card-title text-xl">New Game 2</div>
                    <p class="game-card-description text-xs text-gray-400">
                        More fun with this upcoming game!
                    </p>
                    <a href="#" class="coming-soon-button px-3 py-1 bg-gray-500 text-white font-bold rounded-lg shadow-lg text-sm" data-click-sound="buttonClick">
                        Coming Soon
                    </a>
                </div>
            </div>
            <div class="game-card flex-shrink-0 w-full h-36 transition-all duration-300 ease-in-out transform hover:scale-105 hover:shadow-xl" data-hover-sound="cardHover" data-game-id="newGame3">
                <div class="game-card-content flex flex-col justify-center items-center h-full text-center">
                    <div class="game-card-title text-xl">New Game 3</div>
                    <p class="game-card-description text-xs text-gray-400">
                        Another awesome game is on its way!
                    </p>
                    <a href="#" class="coming-soon-button px-3 py-1 bg-gray-500 text-white font-bold rounded-lg shadow-lg text-sm" data-click-sound="buttonClick">
                        Coming Soon
                    </a>
                </div>
            </div>
        </main>
    </div>

    <!-- Footer now relative to the content-container, allowing main to scroll above it -->
    <footer class="w-full p-4 text-center text-gray-400 text-sm">
        <p>
            Created by: Vladyslav Bieliaiev |
            <a href="https://instagram.com/mmacvv" target="_blank" class="text-blue-400 hover:underline">My Instagram</a>
        </p>
    </footer>

    <!-- Mute/Unmute Button -->
    <button id="toggle-all-sound-button" class="fixed top-4 right-4 bg-gray-700 text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center text-xl z-30 hover:bg-gray-800 transition-colors duration-200">
        <i class="fas fa-volume-up" id="all-sound-icon"></i>
    </button>

    <!-- Game Information Modal -->
    <div id="game-info-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 text-gray-300 p-6 rounded-lg shadow-xl max-w-lg w-full relative">
            <h2 id="modal-game-title" class="text-3xl font-bold mb-4 text-white">Game Title</h2>
            <p id="modal-game-description" class="mb-4 text-lg">Detailed description of the game.</p>
            <p id="modal-game-rules" class="mb-4">Rules: These are the rules for the game.</p>
            <!-- Add more game-specific info here -->
            <button id="close-game-info-modal" class="absolute top-2 right-2 text-gray-400 hover:text-white text-2xl font-bold" data-click-sound="buttonClick">&times;</button>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div id="auth-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 text-gray-300 p-6 rounded-lg shadow-xl max-w-sm w-full relative">
            <h2 id="auth-modal-title" class="text-2xl font-bold mb-4 text-white">Sign In</h2>
            <form id="auth-form" class="flex flex-col gap-4">
                <input type="email" id="auth-email" placeholder="Email" class="p-3 rounded-lg bg-gray-700 border border-gray-600 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <input type="password" id="auth-password" placeholder="Password" class="p-3 rounded-lg bg-gray-700 border border-gray-600 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <input type="text" id="auth-display-name" placeholder="Display Name (for registration)" class="p-3 rounded-lg bg-gray-700 border border-gray-600 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 hidden">
                <button type="submit" id="auth-submit-button" class="px-6 py-3 bg-indigo-600 text-white font-bold rounded-lg shadow-lg hover:bg-indigo-700 transition-all duration-300 ease-in-out transform hover:scale-105" data-click-sound="buttonClick">Sign In</button>
            </form>
            <p id="auth-error-message" class="text-red-400 text-sm mt-2 hidden"></p>
            <button id="toggle-auth-mode" class="mt-4 text-blue-400 hover:underline text-sm" data-click-sound="buttonClick">
                Don't have an account? Register
            </button>
            <button id="close-auth-modal" class="absolute top-2 right-2 text-gray-400 hover:text-white text-2xl font-bold" data-click-sound="buttonClick">&times;</button>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profile-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 text-gray-300 p-6 rounded-lg shadow-xl max-w-sm w-full relative">
            <h2 class="text-2xl font-bold mb-4 text-white">My Profile</h2>
            <p class="mb-2">Hello, <span id="profile-display-name" class="font-bold text-blue-400">Guest</span>!</p>
            <p class="mb-4">Email: <span id="profile-email" class="text-gray-400">Not signed in</span></p>
            <!-- Add more profile info here like wins/losses from Firestore -->
            <button id="profile-sign-out-button" class="px-6 py-3 bg-red-600 text-white font-bold rounded-lg shadow-lg hover:bg-red-700 transition-all duration-300 ease-in-out transform hover:scale-105 mt-4" data-click-sound="buttonClick">Sign Out</button>
            <button id="close-profile-modal" class="absolute top-2 right-2 text-gray-400 hover:text-white text-2xl font-bold" data-click-sound="buttonClick">&times;</button>
        </div>
    </div>


    <script>
        console.log("--- Starting main script execution ---"); // Initial log

        try {
            // Firebase configuration (YOUR CONFIG HAS BEEN INSERTED HERE)
            const firebaseConfig = {
              apiKey: "AIzaSyDYKHgJbQasNpBL0vGrjCz80CjrnqSbTyI",
              authDomain: "game-hub-a99b7.firebaseapp.com",
              projectId: "game-hub-a99b7",
              storageBucket: "game-hub-a99b7.firebasestorage.app",
              messagingSenderId: "328776863852",
              appId: "1:328776863852:web:1adcbbf755fa9854dfc849",
              measurementId: "G-GMTYE5CHRM"
            };
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

            console.log("Firebase config loaded:", firebaseConfig); // Log config
            console.log("App ID:", appId); // Log app ID

            // Initialize Firebase
            if (typeof firebase !== 'undefined' && firebase.apps.length === 0) { // Check if not already initialized
                firebase.initializeApp(firebaseConfig);
                console.log("Firebase app initialized.");
            } else if (typeof firebase === 'undefined') {
                console.error("Firebase global object is not defined. Ensure Firebase SDK scripts are loaded.");
            } else {
                console.log("Firebase app already initialized.");
            }
            
            const auth = firebase.auth();
            const db = firebase.firestore();
            console.log("Firebase Auth and Firestore services initialized.");

            let currentUser = null; // To store current user information

            // Global functions for authentication and Firestore will be attached to window for access from inline script
            window.firebaseApp = firebase.app();
            window.firebaseAuth = auth;
            window.firebaseDb = db;
            window.currentUser = currentUser; // Make currentUser accessible globally

            window.signIn = async (email, password) => {
                try {
                    console.log("Attempting to sign in user:", email);
                    const userCredential = await auth.signInWithEmailAndPassword(email, password);
                    console.log("User signed in:", userCredential.user);
                    return { success: true, user: userCredential.user };
                } catch (error) {
                    console.error("Sign in error:", error.message);
                    return { success: false, error: error.message };
                }
            };

            window.signUp = async (email, password, displayName) => {
                try {
                    console.log("Attempting to sign up user:", email, "with display name:", displayName);
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    const user = userCredential.user;
                    // Store additional user info in Firestore
                    await db.collection("artifacts").doc(appId).collection("users").doc(user.uid).collection("profile").doc("data").set({
                        displayName: displayName,
                        email: user.email,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp() // Use server timestamp
                    });
                    console.log("User signed up:", user);
                    return { success: true, user: user };
                } catch (error) {
                    console.error("Sign up error:", error.message);
                    return { success: false, error: error.message };
                }
            };

            window.signOutUser = async () => {
                try {
                    console.log("Attempting to sign out user.");
                    await auth.signOut();
                    console.log("User signed out.");
                    window.currentUser = null;
                    return { success: true };
                } catch (error) {
                    console.error("Sign out error:", error.message);
                    return { success: false, error: error.message };
                }
            };

            window.getUserProfile = async (uid) => {
                try {
                    console.log("Attempting to get user profile for UID:", uid);
                    const docSnap = await db.collection("artifacts").doc(appId).collection("users").doc(uid).collection("profile").doc("data").get();
                    if (docSnap.exists) {
                        console.log("User profile found:", docSnap.data());
                        return { success: true, profile: docSnap.data() };
                    } else {
                        console.warn("No such user profile document for UID:", uid);
                        return { success: false, error: "No profile found" };
                    }
                } catch (error) {
                    console.error("Error getting user profile for UID:", uid, error.message);
                    return { success: false, error: error.message };
                }
            };

            // Listen for auth state changes
            auth.onAuthStateChanged(async (user) => {
                console.log("Firebase auth state changed listener triggered.");
                const authStatusElement = document.getElementById('auth-status');
                const authButton = document.getElementById('auth-button');
                const profileDisplayName = document.getElementById('profile-display-name');
                const profileEmail = document.getElementById('profile-email');

                if (user) {
                    console.log("Auth state changed: User is signed in", user.uid, user.email);
                    window.currentUser = user;
                    authStatusElement.textContent = `Signed in as: ${user.email}`;
                    authButton.textContent = "My Profile";
                    authButton.onclick = () => openProfileModal();

                    // Fetch user profile from Firestore
                    const profileResult = await window.getUserProfile(user.uid);
                    if (profileResult.success) {
                        profileDisplayName.textContent = profileResult.profile.displayName || user.email;
                    } else {
                        profileDisplayName.textContent = user.email;
                    }
                    profileEmail.textContent = user.email;
                } else {
                    console.log("Auth state changed: User is signed out");
                    window.currentUser = null;
                    authStatusElement.textContent = "Signed out";
                    authButton.textContent = "Sign In / Register";
                    authButton.onclick = () => openAuthModal('signIn'); // Default to sign in
                    profileDisplayName.textContent = "Guest";
                    profileEmail.textContent = "Not signed in";
                }
                updateUIForAuthStatus(); // Update other UI elements
            });

            // Function to update UI elements based on auth status
            function updateUIForAuthStatus() {
                console.log("Updating UI for auth status.");
                const authButton = document.getElementById('auth-button');
                const authStatusElement = document.getElementById('auth-status');
                const profileDisplayNameElement = document.getElementById('profile-display-name');
                const profileEmailElement = document.getElementById('profile-email');
                const signOutButton = document.getElementById('profile-sign-out-button');

                if (window.currentUser) {
                    // User is logged in
                    authButton.textContent = "My Profile";
                    authButton.onclick = openProfileModal;
                    authStatusElement.textContent = `Signed in as: ${window.currentUser.email}`;
                    profileEmailElement.textContent = window.currentUser.email;
                    // Fetch profile display name if available
                    window.getUserProfile(window.currentUser.uid).then(result => {
                        if (result.success) {
                            profileDisplayNameElement.textContent = result.profile.displayName || window.currentUser.email;
                        } else {
                            profileDisplayNameElement.textContent = window.currentUser.email;
                        }
                    });
                    signOutButton.classList.remove('hidden');
                } else {
                    // User is logged out
                    authButton.textContent = "Sign In / Register";
                    authButton.onclick = () => openAuthModal('signIn');
                    authStatusElement.textContent = "Signed out";
                    profileDisplayNameElement.textContent = "Guest";
                    profileEmailElement.textContent = "Not signed in";
                    signOutButton.classList.add('hidden');
                }
            }
            // --- Sound Effects ---
            console.log("Initializing sound effects.");
            let allSoundEnabled = true; // Global flag for all sounds

            // Ensure Tone.js is loaded
            if (typeof Tone === 'undefined') {
                console.error("Tone.js not loaded. Please ensure the script tag is correct.");
            } else {
                console.log("Tone.js is defined. Setting up audio context listener.");
                // Initialize Tone.js context if not already running
                const startAudioContext = () => {
                    if (Tone.context.state !== 'running') {
                        Tone.start().then(() => {
                            console.log("Tone.js AudioContext started successfully.");
                        }).catch(e => console.error("Error starting Tone.js AudioContext:", e));
                    } else {
                        console.log("Tone.js AudioContext already running.");
                    }
                };

                // Attempt to start audio context on any user interaction
                document.documentElement.addEventListener('click', startAudioContext, { once: true });
                document.documentElement.addEventListener('keydown', startAudioContext, { once: true });


                // Synth for card hover sounds 
                const cardHoverSynth = new Tone.PolySynth(Tone.Synth, {
                    volume: -15, 
                    oscillator: { type: "sine" }, 
                    envelope: {
                        attack: 0.001,
                        decay: 0.03,
                        sustain: 0.01,
                        release: 0.03,
                        releaseCurve: "exponential" 
                    }
                }).toDestination();

                // Synth for button click sounds
                const buttonClickSynth = new Tone.PolySynth(Tone.Synth, {
                    volume: -15, // Matches card hover synth volume
                    oscillator: { type: "sine" }, // Matches card hover synth oscillator
                    envelope: {
                        attack: 0.001,
                        decay: 0.03,
                        sustain: 0.01,
                        release: 0.03,
                        releaseCurve: "exponential" // Matches card hover synth envelope
                    }
                }).toDestination();

                // Function to play a hover sound (for cards only now)
                function playCardHoverSound() {
                    if (!allSoundEnabled) {
                        return;
                    }
                    if (Tone.context.state === 'running') {
                        cardHoverSynth.triggerAttackRelease("G4", "64n"); 
                        console.log("Card hover sound played.");
                    } else {
                        console.warn("AudioContext not running for card hover. User interaction needed.");
                    }
                }

                // Function to play a click sound
                function playButtonClickSound() {
                    if (!allSoundEnabled) {
                        return;
                    }
                    if (Tone.context.state === 'running') {
                        buttonClickSynth.triggerAttackRelease("C5", "32n"); 
                        console.log("Button click sound played.");
                    } else {
                        console.warn("AudioContext not running for button click. User interaction needed.");
                    }
                }

                // Add event listeners to game cards for hover (only cards now)
                document.querySelectorAll('.game-card').forEach(card => {
                    card.addEventListener('mouseenter', playCardHoverSound);
                    // Add click listener to the card itself (not the button) for modal
                    card.addEventListener('click', (event) => {
                        // Prevent opening modal if a child button was clicked
                        if (event.target.closest('a')) {
                            console.log("Clicked a button inside card, not opening modal.");
                            playButtonClickSound(); // Play click sound for buttons
                            return;
                        }
                        playButtonClickSound(); // Play click sound for card click
                        openGameInfoModal(card.dataset.gameId);
                    });
                });

                // Add event listeners to play buttons for click (only click now)
                document.querySelectorAll('.play-button, .play-button-small, .coming-soon-button, #search-button, #toggle-all-sound-button, #close-game-info-modal, #auth-submit-button, #toggle-auth-mode, #close-auth-modal, #profile-sign-out-button, #close-profile-modal').forEach(button => {
                    button.addEventListener('click', playButtonClickSound); // Play click sound on click
                });


                // Mute/Unmute Button Logic
                const toggleAllSoundButton = document.getElementById('toggle-all-sound-button');
                const allSoundIcon = document.getElementById('all-sound-icon');

                toggleAllSoundButton.addEventListener('click', () => {
                    allSoundEnabled = !allSoundEnabled;
                    if (allSoundEnabled) {
                        Tone.Destination.volume.value = 0; // Unmute (0 dB)
                        allSoundIcon.classList.remove('fa-volume-mute');
                        allSoundIcon.classList.add('fa-volume-up');
                        console.log("All sounds unmuted.");
                    } else {
                        Tone.Destination.volume.value = -Infinity; // Mute completely
                        allSoundIcon.classList.remove('fa-volume-up');
                        allSoundIcon.classList.add('fa-volume-mute');
                        console.log("All sounds muted.");
                    }
                    // Ensure audio context is started if unmuting
                    if (allSoundEnabled && Tone.context.state !== 'running') {
                        startAudioContext();
                    }
                });
            }

            // --- Game Info Modal Logic ---
            console.log("Initializing Game Info Modal logic.");
            const gameInfoModal = document.getElementById('game-info-modal');
            const closeGameInfoModalButton = document.getElementById('close-game-info-modal');
            const modalGameTitle = document.getElementById('modal-game-title');
            const modalGameDescription = document.getElementById('modal-game-description');
            const modalGameRules = document.getElementById('modal-game-rules');

            const gameDetails = {
                "2048": {
                    title: "2048",
                    description: "Merge identical tiles to reach the 2048 tile! Slide tiles by swiping or using arrow keys. When two tiles with the same number touch, they merge into one. Keep merging to score higher and reach the ultimate tile!",
                    rules: "Use arrow keys or swipe to move tiles. Tiles with the same number merge into one. The game ends when the board is full and no more moves are possible."
                },
                "ticTacToe": {
                    title: "Tic-Tac-Toe",
                    description: "A classic strategy game for two players, 'X' and 'O', who take turns marking the spaces in a 3x3 grid. The player who succeeds in placing three of their marks in a horizontal, vertical, or diagonal row wins the game.",
                    rules: "Players take turns marking a square. The first player to get three of their marks in a row (horizontal, vertical, or diagonal) wins."
                },
                "hangman": {
                    title: "Hangman",
                    description: "Guess the hidden word one letter at a time to save the stick figure from being hanged. Each wrong guess adds another part to the gallows! Be careful with your guesses!",
                    rules: "Guess letters. For each incorrect guess, a part of the hangman is drawn. You lose if the hangman is complete before you guess the word."
                },
                "newGame1": {
                    title: "New Game 1",
                    description: "This is a placeholder for another exciting game to come! Stay tuned for updates and get ready for new challenges.",
                    rules: "Rules for New Game 1 will be revealed soon!"
                },
                "newGame2": {
                    title: "New Game 2",
                    description: "Get ready for more fun with this upcoming game! It promises unique gameplay and endless entertainment.",
                    rules: "Rules for New Game 2 will be revealed soon!"
                },
                "newGame3": {
                    title: "New Game 3",
                    description: "Another awesome game is on its way! Prepare for an unforgettable adventure and new gaming experiences.",
                    rules: "Rules for New Game 3 will be revealed soon!"
                }
            };

            function openGameInfoModal(gameId) {
                const details = gameDetails[gameId];
                if (details) {
                    modalGameTitle.textContent = details.title;
                    modalGameDescription.textContent = details.description;
                    modalGameRules.textContent = "Rules: " + details.rules;
                    gameInfoModal.classList.remove('hidden');
                } else {
                    console.error("Game details not found for ID:", gameId);
                }
            }

            closeGameInfoModalButton.addEventListener('click', () => {
                gameInfoModal.classList.add('hidden');
            });

            // Close modal when clicking outside
            gameInfoModal.addEventListener('click', (event) => {
                if (event.target === gameInfoModal) {
                    gameInfoModal.classList.add('hidden');
                }
            });


            // --- Search Functionality ---
            console.log("Initializing Search Functionality.");
            const gameSearchInput = document.getElementById('game-search');
            const allGameCards = document.querySelectorAll('.game-card');

            gameSearchInput.addEventListener('input', () => {
                const searchTerm = gameSearchInput.value.toLowerCase();
                allGameCards.forEach(card => {
                    const title = card.querySelector('.game-card-title').textContent.toLowerCase();
                    const description = card.querySelector('.game-card-description').textContent.toLowerCase();
                    if (title.includes(searchTerm) || description.includes(searchTerm)) {
                        card.style.display = ''; // Show card
                    } else {
                        card.style.display = 'none'; // Hide card
                    }
                });
            });

            // Optional: Trigger search on button click as well
            document.getElementById('search-button').addEventListener('click', () => {
                const searchTerm = gameSearchInput.value.toLowerCase(); // Re-read value on click
                allGameCards.forEach(card => {
                    const title = card.querySelector('.game-card-title').textContent.toLowerCase();
                    const description = card.querySelector('.game-card-description').textContent.toLowerCase();
                    if (title.includes(searchTerm) || description.includes(searchTerm)) {
                        card.style.display = ''; // Show card
                    } else {
                        card.style.display = 'none'; // Hide card
                    }
                });
            });

            // --- Smooth Page Transitions (Conceptual Implementation) ---
            console.log("Initializing Smooth Page Transitions.");
            document.querySelectorAll('a[href^="http"]:not([target="_blank"]), a[href^="game.html"], a[href^="tic_tac_toe.html"], a[href^="tic_tac_toe_ai.html"], a[href^="hangman.html"]').forEach(link => {
                link.addEventListener('click', function(e) {
                    // Only apply transition to internal links that are not game buttons
                    if (this.classList.contains('play-button') || this.classList.contains('play-button-small') || this.classList.contains('coming-soon-button')) {
                        // Let game buttons navigate normally after their click sound
                        return;
                    }

                    e.preventDefault(); // Prevent default navigation immediately
                    const destination = this.href;

                    // Add a class to body to trigger fade-out animation
                    document.body.classList.add('fade-out');

                    // Navigate after animation duration
                    setTimeout(() => {
                        window.location.href = destination;
                    }, 300); // Match CSS transition duration
                });
            });

            // Add fade-in on page load
            document.addEventListener('DOMContentLoaded', () => {
                console.log("DOMContentLoaded event fired. Adding fade-in class.");
                document.body.classList.add('fade-in');
            });

            // --- Authentication Modals Logic ---
            console.log("Initializing Authentication Modals Logic.");
            const authModal = document.getElementById('auth-modal');
            const closeAuthModalButton = document.getElementById('close-auth-modal');
            const toggleAuthModeButton = document.getElementById('toggle-auth-mode');
            const authModalTitle = document.getElementById('auth-modal-title');
            const authForm = document.getElementById('auth-form');
            const authEmailInput = document.getElementById('auth-email');
            const authPasswordInput = document.getElementById('auth-password');
            const authDisplayNameInput = document.getElementById('auth-display-name');
            const authSubmitButton = document.getElementById('auth-submit-button');
            const authErrorMessage = document.getElementById('auth-error-message');

            const profileModal = document.getElementById('profile-modal');
            const closeProfileModalButton = document.getElementById('close-profile-modal');
            const profileSignOutButton = document.getElementById('profile-sign-out-button');

            let isSignInMode = true; // State for auth modal

            window.openAuthModal = (mode = 'signIn') => {
                console.log(`Opening Auth Modal in ${mode} mode.`);
                isSignInMode = (mode === 'signIn');
                authModalTitle.textContent = isSignInMode ? "Sign In" : "Register";
                authSubmitButton.textContent = isSignInMode ? "Sign In" : "Register";
                toggleAuthModeButton.textContent = isSignInMode ? "Don't have an account? Register" : "Already have an account? Sign In";
                authDisplayNameInput.classList.toggle('hidden', isSignInMode);
                authErrorMessage.classList.add('hidden'); // Clear previous errors
                authModal.classList.remove('hidden');
            };

            window.openProfileModal = async () => {
                console.log("Attempting to open Profile Modal.");
                if (window.currentUser) {
                    document.getElementById('profile-display-name').textContent = "Loading...";
                    document.getElementById('profile-email').textContent = window.currentUser.email;

                    const profileResult = await window.getUserProfile(window.currentUser.uid);
                    if (profileResult.success) {
                        document.getElementById('profile-display-name').textContent = profileResult.profile.displayName || window.currentUser.email;
                    } else {
                        document.getElementById('profile-display-name').textContent = window.currentUser.email;
                    }
                    profileModal.classList.remove('hidden');
                } else {
                    console.warn("No user signed in to open profile modal. Redirecting to sign in.");
                    openAuthModal('signIn'); // Redirect to sign in if no user
                }
            };

            closeAuthModalButton.addEventListener('click', () => {
                console.log("Closing Auth Modal.");
                authModal.classList.add('hidden');
            });

            toggleAuthModeButton.addEventListener('click', () => {
                console.log("Toggling Auth Mode.");
                isSignInMode = !isSignInMode;
                openAuthModal(isSignInMode ? 'signIn' : 'register');
            });

            authForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                console.log("Auth form submitted.");
                authErrorMessage.classList.add('hidden'); // Hide previous error

                const email = authEmailInput.value;
                const password = authPasswordInput.value;
                const displayName = authDisplayNameInput.value;

                if (isSignInMode) {
                    console.log("Attempting sign in.");
                    const result = await window.signIn(email, password);
                    if (result.success) {
                        console.log("Sign in successful, closing modal.");
                        authModal.classList.add('hidden');
                    } else {
                        console.error("Sign in failed:", result.error);
                        authErrorMessage.textContent = result.error;
                        authErrorMessage.classList.remove('hidden');
                    }
                } else {
                    console.log("Attempting registration.");
                    const result = await window.signUp(email, password, displayName);
                    if (result.success) {
                        console.log("Registration successful, closing modal.");
                        authModal.classList.add('hidden');
                    } else {
                        console.error("Registration failed:", result.error);
                        authErrorMessage.textContent = result.error;
                        authErrorMessage.classList.remove('hidden');
                    }
                }
            });

            closeProfileModalButton.addEventListener('click', () => {
                console.log("Closing Profile Modal.");
                profileModal.classList.add('hidden');
            });

            profileSignOutButton.addEventListener('click', async () => {
                console.log("Sign out button clicked.");
                const result = await window.signOutUser();
                if (result.success) {
                    console.log("Sign out successful, closing profile modal.");
                    profileModal.classList.add('hidden');
                }
            });

            // Close modals when clicking outside
            authModal.addEventListener('click', (event) => {
                if (event.target === authModal) {
                    console.log("Clicked outside Auth Modal, closing.");
                    authModal.classList.add('hidden');
                }
            });
            profileModal.addEventListener('click', (event) => {
                if (event.target === profileModal) {
                    console.log("Clicked outside Profile Modal, closing.");
                    profileModal.classList.add('hidden');
                }
            });
        } catch (e) {
            console.error("Critical error in main script block:", e);
            document.body.innerHTML = `<div style="color: red; padding: 20px; font-size: 24px;">Ошибка загрузки страницы: ${e.message}. Пожалуйста, проверьте консоль разработчика для получения подробной информации.</div>`;
        }
        console.log("--- Main script execution finished ---"); // Final log
    </script>
</body>
</html>
