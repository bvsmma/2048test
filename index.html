<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Hub</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <!-- Styles for the homepage -->
    <link rel="stylesheet" href="home.css">
    <!-- Tone.js for sound effects, loaded globally for all pages -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- Firebase SDKs (UPDATED: Using standard scripts for GitHub Pages compatibility) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>
<body class="bg-gray-900 text-white">
    <div class="background-overlay"></div>
    
    <div id="app-content" class="relative z-10 flex flex-col min-h-screen">
        <!-- Header -->
        <header class="p-5 flex justify-between items-center bg-transparent">
            <h1 class="text-3xl font-black tracking-tighter text-slate-100">ИГРОВОЙ ХАБ</h1>
            <div>
                <button id="account-button" class="account-button">
                    <i class="fas fa-user-circle text-2xl"></i>
                    <span id="account-button-text">Аккаунт</span>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow p-5">
            <div id="game-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                <!-- Game Card 1: Tic Tac Toe -->
                <div class="game-card rounded-2xl overflow-hidden shadow-lg transform hover:scale-105 transition-transform duration-300 m-4 flex flex-col">
                    <img class="w-full h-56 object-cover" src="https://i.imgur.com/kH10r0P.png" alt="Tic Tac Toe Game">
                    <div class="p-8 flex flex-col flex-grow">
                        <h3 class="font-bold text-2xl mb-3 text-slate-100">Крестики-нолики</h3>
                        <p class="text-slate-300 text-lg flex-grow">
                            Классическая игра в крестики-нолики. Сыграйте против друга на одном устройстве.
                        </p>
                        <div class="mt-4">
                            <button onclick="navigateToGame('tic-tac-toe/index.html')" class="play-button w-full">
                                Играть
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Game Card 2: Snake -->
                <div class="game-card rounded-2xl overflow-hidden shadow-lg transform hover:scale-105 transition-transform duration-300 m-4 flex flex-col">
                    <img class="w-full h-56 object-cover" src="https://i.imgur.com/3d0y0sT.png" alt="Snake Game">
                    <div class="p-8 flex flex-col flex-grow">
                        <h3 class="font-bold text-2xl mb-3 text-slate-100">Змейка</h3>
                        <p class="text-slate-300 text-lg flex-grow">
                            Управляйте змеей, ешьте еду и становитесь длиннее. Избегайте столкновений со стенами и собственным хвостом!
                        </p>
                        <div class="mt-4">
                            <button onclick="navigateToGame('snake/index.html')" class="play-button w-full">
                                Играть
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Game Card 3: Pong -->
                <div class="game-card rounded-2xl overflow-hidden shadow-lg transform hover:scale-105 transition-transform duration-300 m-4 flex flex-col">
                    <img class="w-full h-56 object-cover" src="https://i.imgur.com/O6zB8eY.png" alt="Pong Game">
                    <div class="p-8 flex flex-col flex-grow">
                        <h3 class="font-bold text-2xl mb-3 text-slate-100">Понг</h3>
                        <p class="text-slate-300 text-lg flex-grow">
                            Аркадная классика. Перемещайте свою платформу, чтобы отбивать мяч и набирать очки против оппонента.
                        </p>
                        <div class="mt-4">
                            <button onclick="navigateToGame('pong/index.html')" class="play-button w-full">
                                Играть
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Game Card 4: Memory Game -->
                <div class="game-card rounded-2xl overflow-hidden shadow-lg transform hover:scale-105 transition-transform duration-300 m-4 flex flex-col">
                    <img class="w-full h-56 object-cover" src="https://i.imgur.com/r6d1vL8.png" alt="Memory Game">
                    <div class="p-8 flex flex-col flex-grow">
                        <h3 class="font-bold text-2xl mb-3 text-slate-100">Игра на память</h3>
                        <p class="text-slate-300 text-lg flex-grow">
                            Проверьте свою память, находя совпадающие пары карточек. Очистите поле как можно быстрее!
                        </p>
                        <div class="mt-4">
                            <button onclick="navigateToGame('memory-game/index.html')" class="play-button w-full">
                                Играть
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Add more game cards here if needed -->
            </div>
        </main>

        <!-- Footer -->
        <footer class="p-5 text-center text-slate-400 bg-transparent">
            <p>&copy; 2024 Игровой Хаб. Все права защищены.</p>
        </footer>
    </div>

    <!-- Modals (Auth, Profile, Notification) -->
    <!-- Authentication Modal -->
    <div id="auth-modal" class="modal-container fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
        <div class="rounded-lg p-8 shadow-2xl w-full max-w-md relative">
            <button class="close-modal-button" aria-label="Close authentication modal">&times;</button>
            <div id="auth-content"></div>
        </div>
    </div>
    
    <!-- Profile Modal -->
    <div id="profile-modal" class="modal-container fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
        <div class="rounded-lg p-8 shadow-2xl w-full max-w-md relative text-center">
            <button class="close-modal-button" aria-label="Close profile modal">&times;</button>
            <h2 class="text-3xl font-bold mb-4">Профиль</h2>
            <p id="profile-email" class="mb-2"></p>
            <p id="profile-email-verified" class="mb-4"></p>
            <button id="send-verification-email-button" class="auth-button-secondary w-full mb-4 hidden">Отправить письмо для подтверждения</button>
            <button id="profile-sign-out-button" class="auth-button w-full">Выйти</button>
        </div>
    </div>

    <!-- Notification Modal -->
    <div id="notification-modal" class="modal-container fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
        <div class="rounded-lg p-8 shadow-2xl w-full max-w-md relative">
            <button class="close-modal-button" aria-label="Close notification modal">&times;</button>
            <h2 id="notification-title" class="text-2xl font-bold mb-4"></h2>
            <p id="notification-message"></p>
        </div>
    </div>
    
    <script src="firebase-config.js"></script>
    <script>
        // --- SOUNDS ---
        const navigationSound = new Tone.Player("https://assets.codepen.io/219293/ui-click.wav").toDestination();
        const modalOpenSound = new Tone.Player("https://assets.codepen.io/219293/ui-open.wav").toDestination();
        const modalCloseSound = new Tone.Player("https://assets.codepen.io/219293/ui-close.wav").toDestination();
        
        // --- PAGE NAVIGATION ---
        function navigateToGame(url) {
            navigationSound.start();
            document.body.classList.add('fade-out');
            setTimeout(() => {
                window.location.href = url;
            }, 500);
        }

        window.addEventListener('load', () => {
            document.body.classList.add('fade-in');
        });
        
        // --- MODAL HANDLING ---
        const authModal = document.getElementById('auth-modal');
        const profileModal = document.getElementById('profile-modal');
        const notificationModal = document.getElementById('notification-modal');

        function openModal(modal) {
            modalOpenSound.start();
            modal.classList.add('modal-visible');
        }

        function closeModal(modal) {
            modalCloseSound.start();
            modal.classList.remove('modal-visible');
        }

        // Close modals with Escape key or by clicking the background
        [authModal, profileModal, notificationModal].forEach(modal => {
            modal.addEventListener('click', (event) => {
                if (event.target === modal) closeModal(modal);
            });
            modal.querySelector('.close-modal-button').addEventListener('click', () => closeModal(modal));
        });
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                [authModal, profileModal, notificationModal].forEach(closeModal);
            }
        });

        function openNotificationModal(title, message) {
            document.getElementById('notification-title').textContent = title;
            document.getElementById('notification-message').textContent = message;
            openModal(notificationModal);
        }

        // --- AUTH UI LOGIC ---
        const authContent = document.getElementById('auth-content');

        const signInForm = `
            <h2 class="text-3xl font-bold mb-6 text-center">Вход</h2>
            <p id="auth-error-message" class="text-red-400 mb-4 text-center hidden"></p>
            <input id="email-input" type="email" placeholder="Email" class="auth-input">
            <input id="password-input" type="password" placeholder="Пароль" class="auth-input">
            <button id="sign-in-button" class="auth-button w-full mb-4">Войти</button>
            <button id="google-sign-in-button" class="auth-button-secondary w-full mb-4">
                <i class="fab fa-google mr-2"></i> Войти с Google
            </button>
            <p class="text-center text-slate-400">Нет аккаунта? <a href="#" id="show-sign-up" class="font-semibold text-indigo-400 hover:underline">Создать</a></p>
        `;

        const signUpForm = `
            <h2 class="text-3xl font-bold mb-6 text-center">Регистрация</h2>
            <p id="auth-error-message" class="text-red-400 mb-4 text-center hidden"></p>
            <input id="email-input" type="email" placeholder="Email" class="auth-input">
            <input id="password-input" type="password" placeholder="Пароль" class="auth-input">
            <button id="sign-up-button" class="auth-button w-full mb-4">Создать аккаунт</button>
            <button id="google-sign-in-button" class="auth-button-secondary w-full mb-4">
                <i class="fab fa-google mr-2"></i> Войти с Google
            </button>
            <p class="text-center text-slate-400">Уже есть аккаунт? <a href="#" id="show-sign-in" class="font-semibold text-indigo-400 hover:underline">Войти</a></p>
        `;

        function openAuthModal(formType) {
            authContent.innerHTML = formType === 'signIn' ? signInForm : signUpForm;
            openModal(authModal);
            attachAuthListeners();
        }
        
        function openProfileModal() {
            const user = window.currentUser;
            if (!user) return;
            document.getElementById('profile-email').textContent = user.email;
            const verifiedStatus = document.getElementById('profile-email-verified');
            const sendVerificationBtn = document.getElementById('send-verification-email-button');
            
            if (user.emailVerified) {
                verifiedStatus.textContent = 'Email подтвержден';
                verifiedStatus.className = 'text-green-400 mb-4';
                sendVerificationBtn.classList.add('hidden');
            } else {
                verifiedStatus.textContent = 'Email не подтвержден';
                verifiedStatus.className = 'text-yellow-400 mb-4';
                sendVerificationBtn.classList.remove('hidden');
            }
            openModal(profileModal);
        }

        function updateAccountButton(user) {
            const buttonText = document.getElementById('account-button-text');
            if (user) {
                buttonText.textContent = user.email.split('@')[0];
            } else {
                buttonText.textContent = 'Аккаунт';
            }
        }
        
        // --- MAIN SCRIPT EXECUTION ---
        try {
            // Check for firebase config, if not present, show error
            if (typeof firebaseConfig === 'undefined') {
                throw new Error("Конфигурация Firebase не найдена. Пожалуйста, убедитесь, что firebase-config.js загружен правильно.");
            }

            // Initialize Firebase
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            window.auth = firebase.auth();
            window.firestore = firebase.firestore();
            window.googleProvider = new firebase.auth.GoogleAuthProvider();
            window.currentUser = null;
            
            // Auth state listener
            window.auth.onAuthStateChanged(user => {
                window.currentUser = user;
                updateAccountButton(user);
            });
            
            // --- AUTH FUNCTIONS (now globally accessible) ---
            window.signUpUser = async (email, password) => {
                try {
                    const userCredential = await window.auth.createUserWithEmailAndPassword(email, password);
                    await userCredential.user.sendEmailVerification();
                    return { success: true, message: "Письмо для подтверждения отправлено на ваш email." };
                } catch (error) {
                    return { error: error.message };
                }
            };

            window.signInUser = async (email, password) => {
                try {
                    await window.auth.signInWithEmailAndPassword(email, password);
                    return { success: true };
                } catch (error) {
                    return { error: error.message };
                }
            };
            
            window.signInWithGoogle = async () => {
                try {
                    await window.auth.signInWithPopup(window.googleProvider);
                    return { success: true };
                } catch (error) {
                    return { error: error.message };
                }
            };

            window.signOutUser = async () => {
                try {
                    await window.auth.signOut();
                    return { success: true };
                } catch (error) {
                    return { error: error.message };
                }
            };

            window.sendVerificationEmail = async () => {
                const user = window.currentUser;
                if (user && !user.emailVerified) {
                    try {
                        await user.sendEmailVerification();
                        return { success: true, message: "Новое письмо для подтверждения отправлено." };
                    } catch (error) {
                        return { error: error.message };
                    }
                }
                return { error: "Нет пользователя или email уже подтвержден." };
            };
            
            // --- EVENT LISTENERS ---
            // This function needs to be callable to re-attach listeners when modal content changes
            window.attachAuthListeners = () => {
                const signInBtn = document.getElementById('sign-in-button');
                const signUpBtn = document.getElementById('sign-up-button');
                const googleSignInBtn = document.getElementById('google-sign-in-button');
                const showSignUpLink = document.getElementById('show-sign-up');
                const showSignInLink = document.getElementById('show-sign-in');

                const handleAuthAction = async (action) => {
                    const email = document.getElementById('email-input').value;
                    const password = document.getElementById('password-input').value;
                    const result = await action(email, password);
                    
                    document.getElementById('auth-error-message').classList.add('hidden');
                    
                    if (result.success) {
                        closeModal(authModal);
                        if (result.message) {
                             openNotificationModal("Регистрация успешна", result.message);
                        }
                    } else {
                        document.getElementById('auth-error-message').textContent = result.error;
                        document.getElementById('auth-error-message').classList.remove('hidden');
                    }
                };

                if (signInBtn) signInBtn.addEventListener('click', () => handleAuthAction(window.signInUser));
                if (signUpBtn) signUpBtn.addEventListener('click', () => handleAuthAction(window.signUpUser));
                if (googleSignInBtn) googleSignInBtn.addEventListener('click', async () => {
                    const result = await window.signInWithGoogle();
                    if(result.success) closeModal(authModal);
                });

                if (showSignUpLink) showSignUpLink.addEventListener('click', (e) => { e.preventDefault(); openAuthModal('signUp'); });
                if (showSignInLink) showSignInLink.addEventListener('click', (e) => { e.preventDefault(); openAuthModal('signIn'); });
            };
            
            // Attach event listeners for profile modal buttons
            document.getElementById('profile-sign-out-button').addEventListener('click', async () => {
                const result = await window.signOutUser();
                if (result.success) {
                    closeModal(profileModal);
                    openNotificationModal("Signed Out", "You have been signed out.");
                }
            });

            document.getElementById('send-verification-email-button').addEventListener('click', async () => {
                const result = await window.sendVerificationEmail();
                openNotificationModal(result.success ? "Verification Sent" : "Error", result.message || result.error);
            });

            // Account button opens the right modal depending on auth state
            document.getElementById('account-button').addEventListener('click', () => {
                if (window.currentUser) {
                    openProfileModal();
                } else {
                    openAuthModal('signIn');
                }
            });

        } catch (e) {
            document.body.innerHTML = `<div style="color: red; padding: 20px; font-size: 24px;">Ошибка загрузки страницы: ${e.message}.</div>`;
        }
    </script>
</body>
</html>

